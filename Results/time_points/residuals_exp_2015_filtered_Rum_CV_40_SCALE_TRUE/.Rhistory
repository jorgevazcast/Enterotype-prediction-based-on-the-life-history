load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/nested_cross_validation/classifiers/nested_cross_validation_rf_filtered/Residuals/time_points/kfold_40/residuals_exp_2015_filtered_Rum_CV_40_SCALE_TRUE/rminer_list.17.RData")
load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/jiyeon_nested_cv_figure/roc_ggplot_1995_fin.RData")
library(pROC)
#library(cvAUC)
library(ggplot2)
load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/nested_cross_validation/classifiers/summary_models_filtered/best_model/Best_MCC_AUC_above_70_rminer_objects/Bact1_1995.RData")
list_ggroc <- list()
load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/nested_cross_validation/classifiers/summary_models_nested_cross_validation_rf_filtered/best_model/Best_MCC_AUC_above_70_rminer_objects/Bact1_1995.RData")
load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/nested_cross_validation/classifiers/summary_models_nested_cross_validation_rf_filtered/best_model/Best_MCC_AUC_above_70_rminer_objects/Bact1_1995.RData")
load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/nested_cross_validation/classifiers/summary_models_nested_cross_validation_rf_filtered/best_model/Best_MCC_AUC_above_70_rminer_objects/Bact1_1995.RData")
library(pROC)
#library(cvAUC)
library(ggplot2)
load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/nested_cross_validation/classifiers/summary_models_nested_cross_validation_rf_filtered/best_model/Best_MCC_AUC_above_70_rminer_objects/Bact1_1995.RData")
View(rminer_list)
list_ggroc <- list()
for(i in 1:length(rminer_list$test)){
print(i)
rocobj2 <- pROC::roc(rminer_list$test[[i]] , rminer_list$pred[[i]][,1]) #true class, predicted prob.
list_ggroc[[i]] <- rocobj2
}
library(tidyverse)
list_sens <- lapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
x$sensitivities
})
list_spec <- lapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
specificities = x$specificities
})
list_auc <- data.frame(sapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
x$auc
}))
colnames(list_auc)="bact1"
auc1=colMeans(list_auc)
auc1<-round(auc1,2)
auc1
biggerCV_partition<- max(unlist(lapply(list_sens,length)))
sens_df <-   matrix(NA, length(rminer_list$test) , biggerCV_partition)
spec_df <-   matrix(NA, length(rminer_list$test), biggerCV_partition)
colnames(sens_df) <- c(1:biggerCV_partition)
colnames(spec_df) <- c(1:biggerCV_partition)
for(inds in 1:length(list_sens) ){
# inds <- 19
print(length(list_sens[[inds]]))
print(length(list_spec[[inds]]))
sens_vec  <- list_sens[[inds]]
names(sens_vec) <- 1:length(sens_vec)
spec_vec  <- list_spec[[inds]]
names(spec_vec) <- 1:length(spec_vec)
sens_df[inds,names(sens_vec)] <- sens_vec
spec_df[inds,names(spec_vec)] <- spec_vec
#sens_df <- rbind(sens_df, list_sens[[inds]])
#spec_df <- rbind(spec_df, list_spec[[inds]])
}
mean.sens_df <- apply(sens_df,2,function(x){mean(x,na.rm=T)})
mean.spec_df  <- apply(spec_df,2,function(x){mean(x,na.rm=T)})
se.spec_df  <- apply(spec_df,2,function(x){sd(x)/sqrt(length(x))})
se.sens_df  <- apply(sens_df,2,function(x){sd(x)/sqrt(length(x))})
mean_ROC_b1 <- data.frame(sens = mean.sens_df, spec = mean.spec_df, se.spec_df,se.sens_df)
ggplot(mean_ROC_b1, aes(x=1-spec, y=sens)) +   geom_path(size = 1.5)+
geom_abline(slope = 1, intercept = 0, lty = 2, colour = 'black')+
geom_errorbar(aes(ymin=sens-se.sens_df, ymax=sens+se.sens_df), width=.03,
position=position_dodge(.9)) +
theme_minimal() +labs(x="FPR", y="TPR")+
theme(text = element_text(size = 12))+
theme(axis.text.x = element_text(colour="black", size=11),axis.ticks.x=element_blank())+
theme(axis.text.y = element_text(colour="black", size=11),axis.ticks.y=element_blank())+
theme(panel.border = element_rect(colour="black", fill=NA))+
scale_color_manual(values=c( "#e6b729", "#e26731", "#a29a3b", "#6f9fbf"))
load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/nested_cross_validation/classifiers/summary_models_nested_cross_validation_rf_filtered/best_model/Best_models.RData")
View(Best_models)
write.csv(Best_models, "~/Downloads/Best_models_each_year.csv")
load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/nested_cross_validation/classifiers/summary_models_filtered/best_model/Best_MCC_AUC_above_70_rminer_objects/Bact1_all.RData")
library(pROC)
#library(cvAUC)
library(ggplot2)
load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/nested_cross_validation/classifiers/summary_models_nested_cross_validation_rf_filtered/best_model/Best_MCC_AUC_above_70_rminer_objects/Bact1_all.RData")
list_ggroc <- list()
for(i in 1:length(rminer_list$test)){
print(i)
rocobj2 <- pROC::roc(rminer_list$test[[i]] , rminer_list$pred[[i]][,1]) #true class, predicted prob.
list_ggroc[[i]] <- rocobj2
}
library(tidyverse)
list_sens <- lapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
x$sensitivities
})
list_spec <- lapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
specificities = x$specificities
})
list_auc <- data.frame(sapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
x$auc
}))
colnames(list_auc)="bact1"
auc1=colMeans(list_auc)
auc1<-round(auc1,2)
auc1
biggerCV_partition<- max(unlist(lapply(list_sens,length)))
sens_df <-   matrix(NA, length(rminer_list$test) , biggerCV_partition)
spec_df <-   matrix(NA, length(rminer_list$test), biggerCV_partition)
colnames(sens_df) <- c(1:biggerCV_partition)
colnames(spec_df) <- c(1:biggerCV_partition)
for(inds in 1:length(list_sens) ){
# inds <- 19
print(length(list_sens[[inds]]))
print(length(list_spec[[inds]]))
sens_vec  <- list_sens[[inds]]
names(sens_vec) <- 1:length(sens_vec)
spec_vec  <- list_spec[[inds]]
names(spec_vec) <- 1:length(spec_vec)
sens_df[inds,names(sens_vec)] <- sens_vec
spec_df[inds,names(spec_vec)] <- spec_vec
#sens_df <- rbind(sens_df, list_sens[[inds]])
#spec_df <- rbind(spec_df, list_spec[[inds]])
}
mean.sens_df <- apply(sens_df,2,function(x){mean(x,na.rm=T)})
mean.spec_df  <- apply(spec_df,2,function(x){mean(x,na.rm=T)})
se.spec_df  <- apply(spec_df,2,function(x){sd(x)/sqrt(length(x))})
se.sens_df  <- apply(sens_df,2,function(x){sd(x)/sqrt(length(x))})
mean_ROC_b1 <- data.frame(sens = mean.sens_df, spec = mean.spec_df, se.spec_df,se.sens_df)
################################## Bact2
load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/nested_cross_validation/classifiers/summary_models_nested_cross_validation_rf_filtered/best_model/Best_MCC_AUC_above_70_rminer_objects/Bact2_all.RData")
list_ggroc <- list()
for(i in 1:length(rminer_list$test)){
print(i)
rocobj2 <- pROC::roc(rminer_list$test[[i]] , rminer_list$pred[[i]][,1]) #true class, predicted prob.
list_ggroc[[i]] <- rocobj2
}
library(tidyverse)
list_sens <- lapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
x$sensitivities
})
list_spec <- lapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
specificities = x$specificities
})
list_auc <- data.frame(sapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
x$auc
}))
colnames(list_auc)="Bact2"
auc2=colMeans(list_auc)
auc2<-round(auc2,2)
auc2
colnames(list_auc)="Bact2"
auc2=colMeans(list_auc)
auc2<-round(auc2,2)
auc2
biggerCV_partition<- max(unlist(lapply(list_sens,length)))
sens_df <-   matrix(NA, length(rminer_list$test) , biggerCV_partition)
spec_df <-   matrix(NA, length(rminer_list$test), biggerCV_partition)
colnames(sens_df) <- c(1:biggerCV_partition)
colnames(spec_df) <- c(1:biggerCV_partition)
for(inds in 1:length(list_sens) ){
# inds <- 19
print(length(list_sens[[inds]]))
print(length(list_spec[[inds]]))
sens_vec  <- list_sens[[inds]]
names(sens_vec) <- 1:length(sens_vec)
spec_vec  <- list_spec[[inds]]
names(spec_vec) <- 1:length(spec_vec)
sens_df[inds,names(sens_vec)] <- sens_vec
spec_df[inds,names(spec_vec)] <- spec_vec
#sens_df <- rbind(sens_df, list_sens[[inds]])
#spec_df <- rbind(spec_df, list_spec[[inds]])
}
mean.sens_df <- apply(sens_df,2,function(x){mean(x,na.rm=T)})
mean.spec_df  <- apply(spec_df,2,function(x){mean(x,na.rm=T)})
se.spec_df  <- apply(spec_df,2,function(x){sd(x)/sqrt(length(x))})
se.sens_df  <- apply(sens_df,2,function(x){sd(x)/sqrt(length(x))})
mean_ROC_b2 <- data.frame(sens = mean.sens_df, spec = mean.spec_df, se.spec_df,se.sens_df)
############################# Prev
load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/nested_cross_validation/classifiers/nested_cross_validation_rf_filtered_noDown/Residuals/all_time_points/kfold_40/All_years_Prev_CV_40_SCALE_TRUE/Best_model_summary.11.RData")
list_ggroc <- list()
for(i in 1:length(rminer_list$test)){
print(i)
rocobj2 <- pROC::roc(rminer_list$test[[i]] , rminer_list$pred[[i]][,1]) #true class, predicted prob.
list_ggroc[[i]] <- rocobj2
}
library(tidyverse)
list_sens <- lapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
x$sensitivities
})
list_spec <- lapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
specificities = x$specificities
})
list_auc <- data.frame(sapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
x$auc
}))
colnames(list_auc)="Prev"
auc3=colMeans(list_auc)
auc3<-round(auc3,2)
auc3
colnames(list_auc)="Prev"
auc3=colMeans(list_auc)
View(list_auc)
load("/Users/sijy/Dropbox/Jiyeon_Jorge/bruneck/model/nested_cross_validation/classifiers/nested_cross_validation_rf_filtered_noDown/Residuals/all_time_points/kfold_40/All_years_Bact1_CV_40_SCALE_TRUE/Best_model_summary.13.RData")
list_ggroc <- list()
for(i in 1:length(rminer_list$test)){
print(i)
rocobj2 <- pROC::roc(rminer_list$test[[i]] , rminer_list$pred[[i]][,1]) #true class, predicted prob.
list_ggroc[[i]] <- rocobj2
}
library(tidyverse)
list_sens <- lapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
x$sensitivities
})
list_spec <- lapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
specificities = x$specificities
})
list_auc <- data.frame(sapply(X = list_ggroc,
FUN = function(x) {
#       r2 <- list_CV_predictions[[x]]
x$auc
}))
colnames(list_auc)="bact1"
auc1=colMeans(list_auc)
auc1<-round(auc1,2)
auc1
